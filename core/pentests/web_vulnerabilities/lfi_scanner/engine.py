import requests


class Engine:
    def __init__(self, urls, payloads, matches, cookie, verbose):
        self.urls = urls
        self.verbose = verbose
        self.payloads = payloads
        self.matches = matches
        self.cookies = cookie

    def start(self):
        if self.cookies:
            cookies = {}
            for cookie in self.cookies.split(';'):
                name, value = cookie.split('=')
                cookies[name] = value
            print(cookies)
        else:
            print("[*] No cookie set, continuing...")

        count_matched = 0
        for payload in self.payloads:
            for url in self.urls:
                urlTarget = url + payload
                r = requests.get(urlTarget, cookies=cookies)
                if self.verbose:
                    print('GET [{0}] {1}'.format(r.status_code, urlTarget))

                for match in self.matches[payload]:
                    if match in r.text:
                        print("Interesting: " + url + payload)
                        count_matched = count_matched + 1
                    if "syntax error" in r.text:
                        print("PHP error: " + url + payload)
        if count_matched == 0:
            print("[-] Nothing found")

        print("[*] Scan completed")
