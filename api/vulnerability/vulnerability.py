from fastapi import APIRouter, Response, Depends
from typing import List
from core.fastapi.dependencies import PermissionDependency, AllowAll
from app.vulnerability.services.vulnerability import VulnerabilityService
from app.user.schemas import (
    ExceptionResponseSchema,
)
from api.vulnerability.response.vulnerability import VulnerabilityResponse
from api.vulnerability.request.vulnerability import VulnerabilityStoreRequest

vulnerability_router = APIRouter()


@vulnerability_router.get(
    "",
    response_model=List[VulnerabilityResponse],
    responses={"400": {"model": ExceptionResponseSchema}},
    dependencies=[Depends(PermissionDependency([AllowAll]))],
)
async def index():
    return await VulnerabilityService.list_vulnerabilities()


@vulnerability_router.post(
    "/store",
    response_model=VulnerabilityResponse,
    responses={"400": {"model": ExceptionResponseSchema}},
    dependencies=[Depends(PermissionDependency([AllowAll]))],
)
async def store(vulnerability: VulnerabilityStoreRequest):
    return await VulnerabilityService.store(vulnerability)
